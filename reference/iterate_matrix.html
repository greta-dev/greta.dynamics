<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Calculate the intrinsic growth rate(s) and stable stage
distribution(s) for a stage-structured dynamical system, encoded
as state_t = matrix \%*\% state_tm1."><title>iterate transition matrices — iterate_matrix • greta.dynamics</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="iterate transition matrices — iterate_matrix"><meta property="og:description" content="Calculate the intrinsic growth rate(s) and stable stage
distribution(s) for a stage-structured dynamical system, encoded
as state_t = matrix \%*\% state_tm1."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">greta.dynamics</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9004</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/iterate-matrix-example.html">iterate-matrix-example</a>
    <a class="dropdown-item" href="../articles/ode-solve-example.html">ode-solve-example</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/greta-dev/greta.dynamics/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>iterate transition matrices</h1>
      <small class="dont-index">Source: <a href="https://github.com/greta-dev/greta.dynamics/blob/HEAD/R/iterate_matrix.R" class="external-link"><code>R/iterate_matrix.R</code></a></small>
      <div class="d-none name"><code>iterate_matrix.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculate the intrinsic growth rate(s) and stable stage
distribution(s) for a stage-structured dynamical system, encoded
as <code>state_t = matrix \%*\% state_tm1</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">iterate_matrix</span><span class="op">(</span></span>
<span>  <span class="va">matrix</span>,</span>
<span>  initial_state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">matrix</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  niter <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  tol <span class="op">=</span> <span class="fl">1e-06</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>matrix</dt>
<dd><p>either a square 2D transition matrix (with dimensions m x m),
or a 3D array (with dimensions n x m x m), giving one or more transition
matrices to iterate</p></dd>


<dt>initial_state</dt>
<dd><p>either a column vector (with m elements) or a 3D array
(with dimensions n x m x 1) giving one or more initial states from which to
iterate the matrix</p></dd>


<dt>niter</dt>
<dd><p>a positive integer giving the maximum number of times to iterate
the matrix</p></dd>


<dt>tol</dt>
<dd><p>a scalar giving a numerical tolerance, below which the algorithm
is determineed to have converged to the same growth rate in all stages</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>a named list with five greta arrays:</p><ul><li><p><code>lambda</code> a scalar or vector giving the ratio of the first stage
values between the final two iterations.</p></li>
<li><p><code>stable_state</code> a vector or matrix (with the same dimensions as
<code>initial_state</code>) giving the state after the final iteration,
normalised so that the values for all stages sum to one.</p></li>
<li><p><code>all_states</code> an n x m x niter matrix of the state values at
each iteration. This will be 0 for all entries after <code>iterations</code>.</p></li>
<li><p><code>converged</code> an integer scalar or vector indicating whether
the iterations for each matrix have converged to a tolerance less than
<code>tol</code> (1 if so, 0 if not) before the algorithm finished.</p></li>
<li><p><code>iterations</code> a scalar of the maximum number of iterations
completed before the algorithm terminated. This should match <code>niter</code>
if <code>converged</code> is <code>FALSE</code>.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>iterate_matrix</code> can either act on a single transition matrix
and initial state (if <code>matrix</code> is 2D and <code>initial_state</code> is a
column vector), or it can simultaneously act on <em>n</em> different matrices
and/or <em>n</em> different initial states (if <code>matrix</code> and
<code>initial_state</code> are 3D arrays). In the latter case, the first
dimension of both objects should be the batch dimension <em>n</em>.</p>
<p>To ensure the matrix is iterated for a specific number of iterations, you
can set that number as <code>niter</code>, and set <code>tol</code> to 0 or a negative
number to ensure that the iterations are not stopped early.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>because greta vectorises across both MCMC chains and the calculation of
greta array values, the algorithm is run until all chains (or posterior
samples), sites and stages have converged to stable growth. So a single
value of both <code>converged</code> and <code>iterations</code> is returned, and the
value of this will always have the same value in an <code>mcmc.list</code> object. So
inspecting the MCMC trace of these parameters will only tell you whether
the iteration converged in <em>all</em> posterior samples, and the maximum
number of iterations required to do so across all these samples</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># simulate from a probabilistic 4-stage transition matrix model</span></span></span>
<span class="r-in"><span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">4</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># component variables</span></span></span>
<span class="r-in"><span><span class="co"># survival probability for all stages</span></span></span>
<span class="r-in"><span><span class="va">survival</span> <span class="op">&lt;-</span> <span class="fu">uniform</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, dim <span class="op">=</span> <span class="va">k</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># conditional (on survival) probability of staying in a stage</span></span></span>
<span class="r-in"><span><span class="va">stasis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">uniform</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, dim <span class="op">=</span> <span class="va">k</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># marginal probability of staying/progressing</span></span></span>
<span class="r-in"><span><span class="va">stay</span> <span class="op">&lt;-</span> <span class="va">survival</span> <span class="op">*</span> <span class="va">stasis</span></span></span>
<span class="r-in"><span><span class="va">progress</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">survival</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">stay</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">k</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="co"># recruitment rate for the largest two stages</span></span></span>
<span class="r-in"><span><span class="va">recruit</span> <span class="op">&lt;-</span> <span class="fu">exponential</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># combine into a matrix:</span></span></span>
<span class="r-in"><span><span class="va">tmat</span> <span class="op">&lt;-</span> <span class="fu">zeros</span><span class="op">(</span><span class="va">k</span>, <span class="va">k</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">tmat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">stay</span></span></span>
<span class="r-in"><span><span class="va">progress_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/row.html" class="external-link">row</a></span><span class="op">(</span><span class="va">tmat</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/col.html" class="external-link">col</a></span><span class="op">(</span><span class="va">tmat</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="va">tmat</span><span class="op">[</span><span class="va">progress_idx</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">progress</span></span></span>
<span class="r-in"><span><span class="va">tmat</span><span class="op">[</span><span class="fl">1</span>, <span class="va">k</span> <span class="op">-</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">0</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">recruit</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># analyse this to get the intrinsic growth rate and stable state</span></span></span>
<span class="r-in"><span><span class="va">iterations</span> <span class="op">&lt;-</span> <span class="fu">iterate_matrix</span><span class="op">(</span><span class="va">tmat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">iterations</span><span class="op">$</span><span class="va">lambda</span></span></span>
<span class="r-in"><span><span class="va">iterations</span><span class="op">$</span><span class="va">stable_distribution</span></span></span>
<span class="r-in"><span><span class="va">iterations</span><span class="op">$</span><span class="va">all_states</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Can also do this simultaneously for a collection of transition matrices</span></span></span>
<span class="r-in"><span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">10</span></span></span>
<span class="r-in"><span><span class="va">survival</span> <span class="op">&lt;-</span> <span class="fu">uniform</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">k</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">stasis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu">uniform</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, dim <span class="op">=</span> <span class="va">n</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">stay</span> <span class="op">&lt;-</span> <span class="va">survival</span> <span class="op">*</span> <span class="va">stasis</span></span></span>
<span class="r-in"><span><span class="va">progress</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">survival</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">stasis</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">recruit_rate</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">5</span>, length.out <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">recruit</span> <span class="op">&lt;-</span> <span class="fu">exponential</span><span class="op">(</span><span class="va">recruit_rate</span>, dim <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tmats</span> <span class="op">&lt;-</span> <span class="fu">zeros</span><span class="op">(</span><span class="fl">10</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tmats</span><span class="op">[</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">stasis</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">tmats</span><span class="op">[</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">stasis</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">tmats</span><span class="op">[</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">progress</span></span></span>
<span class="r-in"><span><span class="va">tmats</span><span class="op">[</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">recruit</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">iterations</span> <span class="op">&lt;-</span> <span class="fu">iterate_matrix</span><span class="op">(</span><span class="va">tmats</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">iterations</span><span class="op">$</span><span class="va">lambda</span></span></span>
<span class="r-in"><span><span class="va">iterations</span><span class="op">$</span><span class="va">stable_distribution</span></span></span>
<span class="r-in"><span><span class="va">iterations</span><span class="op">$</span><span class="va">all_states</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Nick Golding.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer></div>

  

  

  </body></html>

